swagger: '2.0'
######################################################
# Prolog
######################################################
info:
  version: "1.0.0"
  title: "WSO2 Healthcare Server Consent Management Rest API "
  description: |
    This document specifies a **Consent Management RESTfulAPI** for WSO2 **Open Healthcare Server** .

    It is written with [swagger 2](http://swagger.io/).

  contact:
    name: "WSO2"
    url: "https://wso2.com/solutions/healthcare/"
    email: "architecture@wso2.com"
  license:
    name: "Apache 2.0"
    url: "http://www.apache.org/licenses/LICENSE-2.0.html"

######################################################
# The fixed parts of the URLs of the API
######################################################

# The schemes supported by the API
schemes:
  - https

# The domain of the API.
# This is configured by the customer during deployment.
# The given host is just an example.
# host: apis.is.com

# The base path of the API.
# Will be prefixed to all paths.
# if the tenant domain is carbon.super basepath can be /api/identity/consent-mgt/v1.0 like this too.

basePath: /t/{tenant-domain}/api/healthcare/consent-mgt/v1.0

# The following media types can be passed as input in message bodies of the API.
# The actual media type must be specified in the Content-Type header field of the request.
# The default is json, i.e. the Content-Type header is not needed to
# be set, but supporting it serves extensibility.
consumes:
  - application/json

# The following media types may be passed as output in message bodies of the API.
# The media type(s) consumable by the requester is specified in the Accept header field
# of the corresponding request.
# The actual media type returned will be specified in the Content-Type header field
# of the of the response.
# The default of the Accept header is json, i.e. there is not needed to
# set the value, but supporting it serves extensibility.
produces:
  - application/json
paths:
  # Endpoint used to add service provider app to consent purpose mapping
  "/consents/sp-purpose-mapping":
    post:
      description: |
         This API is used to add service provider app to consent purpose mapping.
      x-wso2-request: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"<Service_Name>\", \"tenantDomain\": \"<Tenant_Domain_Name>\", \"purposes\": [ { \"purposeId\": <Purpose_ID>, \"purposeCategoryId\": [ <Purpose_Category_ID> ], \"consentType\": \"<Consent_Type>\", \"piiCategory\": [ { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" }, { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" } ], \"primaryPurpose\": true, \"termination\": \"days:<Number_Of_Days>\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"<Collection_Method>\", \"jurisdiction\": \"<Jurisdiction>\", \"language\": \"<Language_Abbreviation>\", \"policyURL\": \"<Service_Policy_URL>", \"properties\": [ { \"key\": \"<PII_Controller's_Public_Key>\", \"value\": \"v1\" } ]}"
      x-wso2-curl: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"foo-service\", \"tenantDomain\": \"carbon.super\", \"purposes\": [ { \"purposeId\": 1, \"purposeCategoryId\": [ 1 ], \"consentType\": \"EXPLICIT\", \"piiCategory\": [ { \"piiCategoryId\": 1, \"validity\": \"days:30\" }, { \"piiCategoryId\": 2, \"validity\": \"days:30\" } ], \"primaryPurpose\": true, \"termination\": \"days:30\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"Sign-Up\", \"jurisdiction\": \"CA\", \"language\": \"EN\", \"policyURL\": \"https://foo.com/privacy\", \"properties\": [ { \"key\": \"k1\", \"value\": \"v1\" } ]}"
      x-wso2-response: |
        {"consentReceiptId":"38279263-f385-4252-8966-40998faa95ae","collectionMethod":"Sign-Up","language":"EN","piiPrincipalId":"admin","tenantDomain":"carbon.super"}
      summary: |
        Add service provider app to consent purpose mapping

      # post parameters:
      parameters:
        -
          name: consentSPMapping
          in: body
          description:  This represents the consent to sp mapping element that needs to be stored.
          required: true
          schema:
            $ref: '#/definitions/ConsentSPMappingRequest'
      responses:
        201:
          description: Successful response
          schema:
            $ref: '#/definitions/ConsentSPMappingAddResponse'
          headers:
            Location:
              type: 'string'
              description: 'Location of the newly created consent.'
        400:
          description: Bad Request
          schema:
             $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
             $ref: '#/definitions/Error'
        409:
          description: Conflict
          schema:
             $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
             $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

    get:
      description: |
        This API is used to list service provider app to consent purpose mappings.
      x-wso2-request: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping?limit=<Limit_Number>&offset=<Offset_Number>&piiPrincipalId=<PII_Principal_Name>&spTenantDomain=<Tenant_Domain>&service=<Service_Name>*&state=<ACTIVE/REVOKED>" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json"
      x-wso2-curl: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping?limit=10&offset=0&piiPrincipalId=testuser&spTenantDomain=carbon.super&service=foo*&state=ACTIVE" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json"
      x-wso2-response: |
        [{"consentReceiptID":"7a6886ab-b02f-424f-9cd4-adf5e92f0798","language":"EN","piiPrincipalId":"testuser","tenantDomain":"carbon.super","state":"ACTIVE"}]
      summary: |
        List service provider app to consent purpose mappings
      parameters:
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
        - $ref: '#/parameters/purposeId'
        - $ref: '#/parameters/consumerKey'
        - $ref: '#/parameters/appName'

      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/ConsentSPMappingResponse'
          headers:
            Location:
              type: 'string'
              description: 'Location to retireve the consent element to.'
        400:
          description: Bad Request
          schema:
             $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
             $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
             $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

  "/consents/sp-purpose-mapping/{mappingId}":
    get:
      description: |
        This API is used to retrieve sp consent mapping using the mapping ID.
      x-wso2-request: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/<Consent_Receipt_ID>" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json"
      x-wso2-curl: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/7a6886ab-b02f-424f-9cd4-adf5e92f0798" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json"
      x-wso2-response: |
        {"version":"KI-CR-v1.1.0","jurisdiction":"CA","consentTimestamp":1517742624682,"collectionMethod":"Sign-Up","consentReceiptID":"7a6886ab-b02f-424f-9cd4-adf5e92f0798","publicKey":null,"language":"EN","piiPrincipalId":"testuser","tenantDomain":"carbon.super","state":"ACTIVE","piiControllers":[{"piiController":"sample","contact":"sample","address":{"addressCountry":"USA","addressLocality":"Mountain View","addressRegion":"CA","postOfficeBoxNumber":"233","postalCode":"94043","streetAddress":"1600 Amphitheatre Pkwy"},"email":"sample@abc.com","phone":"+01433444333","onBehalf":false,"piiControllerUrl":"https://sample.piicontroller.url"}],"policyUrl":"https://foo.com/privacy","services":[{"service":"foo-service","tenantDomain":"carbon.super","purposes":[{"purpose":"Contact","purposeCategory":["Legal"],"consentType":"EXPLICIT","piiCategory":[{"piiCategory":"email","validity":"days:30"},{"piiCategory":"username","validity":"days:30"}],"primaryPurpose":true,"termination":"days:30","thirdPartyDisclosure":false,"thirdPartyName":""}]}],"sensitive":false,"spiCat":null}
      summary: |
        Retrieve a sp consent mapping
      parameters:
        - $ref: '#/parameters/mappingId'
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/ConsentSPMappingResponse'
        400:
          description: Bad Request
          schema:
             $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
             $ref: '#/definitions/Error'
        404:
          description: Not Found
          schema:
             $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
             $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

    put:
      description: |
        This API is used to update service provider app to consent purpose mapping.
      x-wso2-request: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"<Service_Name>\", \"tenantDomain\": \"<Tenant_Domain_Name>\", \"purposes\": [ { \"purposeId\": <Purpose_ID>, \"purposeCategoryId\": [ <Purpose_Category_ID> ], \"consentType\": \"<Consent_Type>\", \"piiCategory\": [ { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" }, { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" } ], \"primaryPurpose\": true, \"termination\": \"days:<Number_Of_Days>\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"<Collection_Method>\", \"jurisdiction\": \"<Jurisdiction>\", \"language\": \"<Language_Abbreviation>\", \"policyURL\": \"<Service_Policy_URL>", \"properties\": [ { \"key\": \"<PII_Controller's_Public_Key>\", \"value\": \"v1\" } ]}"
      x-wso2-curl: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"foo-service\", \"tenantDomain\": \"carbon.super\", \"purposes\": [ { \"purposeId\": 1, \"purposeCategoryId\": [ 1 ], \"consentType\": \"EXPLICIT\", \"piiCategory\": [ { \"piiCategoryId\": 1, \"validity\": \"days:30\" }, { \"piiCategoryId\": 2, \"validity\": \"days:30\" } ], \"primaryPurpose\": true, \"termination\": \"days:30\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"Sign-Up\", \"jurisdiction\": \"CA\", \"language\": \"EN\", \"policyURL\": \"https://foo.com/privacy\", \"properties\": [ { \"key\": \"k1\", \"value\": \"v1\" } ]}"
      x-wso2-response: |
        {"consentReceiptId":"38279263-f385-4252-8966-40998faa95ae","collectionMethod":"Sign-Up","language":"EN","piiPrincipalId":"admin","tenantDomain":"carbon.super"}
      summary: |
        Update service provider app to consent purpose mapping

      # post parameters:
      parameters:
        -
          name: consentSPMapping
          in: body
          description:  This represents the consent to sp mapping element that needs to be stored.
          required: true
          schema:
            $ref: '#/definitions/ConsentSPMappingRequest'
      responses:
        201:
          description: Successful response
          schema:
            $ref: '#/definitions/ConsentSPMappingEditResponse'
          headers:
            Location:
              type: 'string'
              description: 'Location of the newly created consent.'
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        409:
          description: Conflict
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

    delete:
      description: |
        This API is used to delete sp consent mapping using the mapping ID.
      x-wso2-request: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/<Consent_Receipt_ID>" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json"
      x-wso2-curl: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/7a6886ab-b02f-424f-9cd4-adf5e92f0798" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json"
      x-wso2-response: |
        {"version":"KI-CR-v1.1.0","jurisdiction":"CA","consentTimestamp":1517742624682,"collectionMethod":"Sign-Up","consentReceiptID":"7a6886ab-b02f-424f-9cd4-adf5e92f0798","publicKey":null,"language":"EN","piiPrincipalId":"testuser","tenantDomain":"carbon.super","state":"ACTIVE","piiControllers":[{"piiController":"sample","contact":"sample","address":{"addressCountry":"USA","addressLocality":"Mountain View","addressRegion":"CA","postOfficeBoxNumber":"233","postalCode":"94043","streetAddress":"1600 Amphitheatre Pkwy"},"email":"sample@abc.com","phone":"+01433444333","onBehalf":false,"piiControllerUrl":"https://sample.piicontroller.url"}],"policyUrl":"https://foo.com/privacy","services":[{"service":"foo-service","tenantDomain":"carbon.super","purposes":[{"purpose":"Contact","purposeCategory":["Legal"],"consentType":"EXPLICIT","piiCategory":[{"piiCategory":"email","validity":"days:30"},{"piiCategory":"username","validity":"days:30"}],"primaryPurpose":true,"termination":"days:30","thirdPartyDisclosure":false,"thirdPartyName":""}]}],"sensitive":false,"spiCat":null}
      summary: |
        Delete a sp consent mapping
      parameters:
        - $ref: '#/parameters/mappingId'
        - $ref: '#/parameters/purposeId'
      responses:
        200:
          description: OK
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        404:
          description: Not Found
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

  "/consents/applications":
    get:
      description: |
        This API is used to retrieve applications defined for consent purposes.
      x-wso2-request: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/<Consent_Receipt_ID>" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json"
      x-wso2-curl: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/7a6886ab-b02f-424f-9cd4-adf5e92f0798" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json"
      x-wso2-response: |
        {"version":"KI-CR-v1.1.0","jurisdiction":"CA","consentTimestamp":1517742624682,"collectionMethod":"Sign-Up","consentReceiptID":"7a6886ab-b02f-424f-9cd4-adf5e92f0798","publicKey":null,"language":"EN","piiPrincipalId":"testuser","tenantDomain":"carbon.super","state":"ACTIVE","piiControllers":[{"piiController":"sample","contact":"sample","address":{"addressCountry":"USA","addressLocality":"Mountain View","addressRegion":"CA","postOfficeBoxNumber":"233","postalCode":"94043","streetAddress":"1600 Amphitheatre Pkwy"},"email":"sample@abc.com","phone":"+01433444333","onBehalf":false,"piiControllerUrl":"https://sample.piicontroller.url"}],"policyUrl":"https://foo.com/privacy","services":[{"service":"foo-service","tenantDomain":"carbon.super","purposes":[{"purpose":"Contact","purposeCategory":["Legal"],"consentType":"EXPLICIT","piiCategory":[{"piiCategory":"email","validity":"days:30"},{"piiCategory":"username","validity":"days:30"}],"primaryPurpose":true,"termination":"days:30","thirdPartyDisclosure":false,"thirdPartyName":""}]}],"sensitive":false,"spiCat":null}
      summary: |
        Retrieve applications defined for consent purposes
      parameters:
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
        - $ref: '#/parameters/consumerKey'
        - $ref: '#/parameters/appName'
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/ApplicationsListResponse'
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        404:
          description: Not Found
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

  "/consents/applications/purpose":
    post:
      description: |
        This API is used to add consent purpose specific to the application.
      x-wso2-request: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"<Service_Name>\", \"tenantDomain\": \"<Tenant_Domain_Name>\", \"purposes\": [ { \"purposeId\": <Purpose_ID>, \"purposeCategoryId\": [ <Purpose_Category_ID> ], \"consentType\": \"<Consent_Type>\", \"piiCategory\": [ { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" }, { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" } ], \"primaryPurpose\": true, \"termination\": \"days:<Number_Of_Days>\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"<Collection_Method>\", \"jurisdiction\": \"<Jurisdiction>\", \"language\": \"<Language_Abbreviation>\", \"policyURL\": \"<Service_Policy_URL>", \"properties\": [ { \"key\": \"<PII_Controller's_Public_Key>\", \"value\": \"v1\" } ]}"
      x-wso2-curl: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"foo-service\", \"tenantDomain\": \"carbon.super\", \"purposes\": [ { \"purposeId\": 1, \"purposeCategoryId\": [ 1 ], \"consentType\": \"EXPLICIT\", \"piiCategory\": [ { \"piiCategoryId\": 1, \"validity\": \"days:30\" }, { \"piiCategoryId\": 2, \"validity\": \"days:30\" } ], \"primaryPurpose\": true, \"termination\": \"days:30\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"Sign-Up\", \"jurisdiction\": \"CA\", \"language\": \"EN\", \"policyURL\": \"https://foo.com/privacy\", \"properties\": [ { \"key\": \"k1\", \"value\": \"v1\" } ]}"
      x-wso2-response: |
        {"consentReceiptId":"38279263-f385-4252-8966-40998faa95ae","collectionMethod":"Sign-Up","language":"EN","piiPrincipalId":"admin","tenantDomain":"carbon.super"}
      summary: |
        Add pii mappings for a purpose

      # post parameters:
      parameters:
        -
          name: appPurpose
          in: body
          description:  This represents the consent purpose specific to the application.
          required: true
          schema:
            $ref: '#/definitions/AppPurposeRequest'
      responses:
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        409:
          description: Conflict
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentAppPurpose

  "/consents/purposes":
    get:
      description: |
        This API is used to retrieve consent purposes.
      x-wso2-request: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/<Consent_Receipt_ID>" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json"
      x-wso2-curl: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/7a6886ab-b02f-424f-9cd4-adf5e92f0798" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json"
      x-wso2-response: |
        {"version":"KI-CR-v1.1.0","jurisdiction":"CA","consentTimestamp":1517742624682,"collectionMethod":"Sign-Up","consentReceiptID":"7a6886ab-b02f-424f-9cd4-adf5e92f0798","publicKey":null,"language":"EN","piiPrincipalId":"testuser","tenantDomain":"carbon.super","state":"ACTIVE","piiControllers":[{"piiController":"sample","contact":"sample","address":{"addressCountry":"USA","addressLocality":"Mountain View","addressRegion":"CA","postOfficeBoxNumber":"233","postalCode":"94043","streetAddress":"1600 Amphitheatre Pkwy"},"email":"sample@abc.com","phone":"+01433444333","onBehalf":false,"piiControllerUrl":"https://sample.piicontroller.url"}],"policyUrl":"https://foo.com/privacy","services":[{"service":"foo-service","tenantDomain":"carbon.super","purposes":[{"purpose":"Contact","purposeCategory":["Legal"],"consentType":"EXPLICIT","piiCategory":[{"piiCategory":"email","validity":"days:30"},{"piiCategory":"username","validity":"days:30"}],"primaryPurpose":true,"termination":"days:30","thirdPartyDisclosure":false,"thirdPartyName":""}]}],"sensitive":false,"spiCat":null}
      summary: |
        Retrieve consent purposes
      parameters:
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/ConsentListPurposeResponse'
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        404:
          description: Not Found
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping
    post:
      description: |
        This API is used to add a new consent purpose.
      x-wso2-request: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"<Service_Name>\", \"tenantDomain\": \"<Tenant_Domain_Name>\", \"purposes\": [ { \"purposeId\": <Purpose_ID>, \"purposeCategoryId\": [ <Purpose_Category_ID> ], \"consentType\": \"<Consent_Type>\", \"piiCategory\": [ { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" }, { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" } ], \"primaryPurpose\": true, \"termination\": \"days:<Number_Of_Days>\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"<Collection_Method>\", \"jurisdiction\": \"<Jurisdiction>\", \"language\": \"<Language_Abbreviation>\", \"policyURL\": \"<Service_Policy_URL>", \"properties\": [ { \"key\": \"<PII_Controller's_Public_Key>\", \"value\": \"v1\" } ]}"
      x-wso2-curl: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"foo-service\", \"tenantDomain\": \"carbon.super\", \"purposes\": [ { \"purposeId\": 1, \"purposeCategoryId\": [ 1 ], \"consentType\": \"EXPLICIT\", \"piiCategory\": [ { \"piiCategoryId\": 1, \"validity\": \"days:30\" }, { \"piiCategoryId\": 2, \"validity\": \"days:30\" } ], \"primaryPurpose\": true, \"termination\": \"days:30\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"Sign-Up\", \"jurisdiction\": \"CA\", \"language\": \"EN\", \"policyURL\": \"https://foo.com/privacy\", \"properties\": [ { \"key\": \"k1\", \"value\": \"v1\" } ]}"
      x-wso2-response: |
        {"consentReceiptId":"38279263-f385-4252-8966-40998faa95ae","collectionMethod":"Sign-Up","language":"EN","piiPrincipalId":"admin","tenantDomain":"carbon.super"}
      summary: |
        Add a new consent purpose

      # post parameters:
      parameters:
        -
          name: consentPurpose
          in: body
          description:  This represents the consent to sp mapping element that needs to be stored.
          required: true
          schema:
            $ref: '#/definitions/ConsentPurposeRequest'
      responses:
        201:
          description: Successful response
          schema:
            $ref: '#/definitions/ConsentAddPurposeResponse'
          headers:
            Location:
              type: 'string'
              description: 'Location of the newly created consent.'
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        409:
          description: Conflict
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

  "/consents/purposes/pii-mapping":
    post:
      description: |
        This API is used to add pii mappings for a purpose.
      x-wso2-request: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"<Service_Name>\", \"tenantDomain\": \"<Tenant_Domain_Name>\", \"purposes\": [ { \"purposeId\": <Purpose_ID>, \"purposeCategoryId\": [ <Purpose_Category_ID> ], \"consentType\": \"<Consent_Type>\", \"piiCategory\": [ { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" }, { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" } ], \"primaryPurpose\": true, \"termination\": \"days:<Number_Of_Days>\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"<Collection_Method>\", \"jurisdiction\": \"<Jurisdiction>\", \"language\": \"<Language_Abbreviation>\", \"policyURL\": \"<Service_Policy_URL>", \"properties\": [ { \"key\": \"<PII_Controller's_Public_Key>\", \"value\": \"v1\" } ]}"
      x-wso2-curl: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"foo-service\", \"tenantDomain\": \"carbon.super\", \"purposes\": [ { \"purposeId\": 1, \"purposeCategoryId\": [ 1 ], \"consentType\": \"EXPLICIT\", \"piiCategory\": [ { \"piiCategoryId\": 1, \"validity\": \"days:30\" }, { \"piiCategoryId\": 2, \"validity\": \"days:30\" } ], \"primaryPurpose\": true, \"termination\": \"days:30\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"Sign-Up\", \"jurisdiction\": \"CA\", \"language\": \"EN\", \"policyURL\": \"https://foo.com/privacy\", \"properties\": [ { \"key\": \"k1\", \"value\": \"v1\" } ]}"
      x-wso2-response: |
        {"consentReceiptId":"38279263-f385-4252-8966-40998faa95ae","collectionMethod":"Sign-Up","language":"EN","piiPrincipalId":"admin","tenantDomain":"carbon.super"}
      summary: |
        Add pii mappings for a purpose

      # post parameters:
      parameters:
        -
          name: pirposePIIMapping
          in: body
          description:  This represents the consent to sp mapping element that needs to be stored.
          required: true
          schema:
            $ref: '#/definitions/PurposePIIMappingRequest'
      responses:
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        409:
          description: Conflict
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

  "/consents/pii-categories":
    get:
      description: |
        This API is used to retrieve pii categories.
      x-wso2-request: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/<Consent_Receipt_ID>" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json"
      x-wso2-curl: |
        curl -k -X GET "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping/7a6886ab-b02f-424f-9cd4-adf5e92f0798" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json"
      x-wso2-response: |
        {"version":"KI-CR-v1.1.0","jurisdiction":"CA","consentTimestamp":1517742624682,"collectionMethod":"Sign-Up","consentReceiptID":"7a6886ab-b02f-424f-9cd4-adf5e92f0798","publicKey":null,"language":"EN","piiPrincipalId":"testuser","tenantDomain":"carbon.super","state":"ACTIVE","piiControllers":[{"piiController":"sample","contact":"sample","address":{"addressCountry":"USA","addressLocality":"Mountain View","addressRegion":"CA","postOfficeBoxNumber":"233","postalCode":"94043","streetAddress":"1600 Amphitheatre Pkwy"},"email":"sample@abc.com","phone":"+01433444333","onBehalf":false,"piiControllerUrl":"https://sample.piicontroller.url"}],"policyUrl":"https://foo.com/privacy","services":[{"service":"foo-service","tenantDomain":"carbon.super","purposes":[{"purpose":"Contact","purposeCategory":["Legal"],"consentType":"EXPLICIT","piiCategory":[{"piiCategory":"email","validity":"days:30"},{"piiCategory":"username","validity":"days:30"}],"primaryPurpose":true,"termination":"days:30","thirdPartyDisclosure":false,"thirdPartyName":""}]}],"sensitive":false,"spiCat":null}
      summary: |
        Retrieve consent purposes
      parameters:
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        200:
          description: OK
          schema:
            $ref: '#/definitions/PIICategoryResponse'
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        404:
          description: Not Found
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping
    post:
      description: |
        This API is used to add a new OH pii category.
      x-wso2-request: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic <Base64Encoded[username:password]>" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"<Service_Name>\", \"tenantDomain\": \"<Tenant_Domain_Name>\", \"purposes\": [ { \"purposeId\": <Purpose_ID>, \"purposeCategoryId\": [ <Purpose_Category_ID> ], \"consentType\": \"<Consent_Type>\", \"piiCategory\": [ { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" }, { \"piiCategoryId\": <PII_Category_ID>, \"validity\": \"days:<Number_Of_Days>\" } ], \"primaryPurpose\": true, \"termination\": \"days:<Number_Of_Days>\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"<Collection_Method>\", \"jurisdiction\": \"<Jurisdiction>\", \"language\": \"<Language_Abbreviation>\", \"policyURL\": \"<Service_Policy_URL>", \"properties\": [ { \"key\": \"<PII_Controller's_Public_Key>\", \"value\": \"v1\" } ]}"
      x-wso2-curl: |
        curl -k -X POST "https://localhost:9443/api/healthcare/consent-mgt/v1.0/consents/sp-purpose-mapping" -H "Authorization: Basic YWRtaW46YWRtaW4=" -H "accept: application/json" -H "Content-Type: application/json" -d "{\"services\": [ { \"service\": \"foo-service\", \"tenantDomain\": \"carbon.super\", \"purposes\": [ { \"purposeId\": 1, \"purposeCategoryId\": [ 1 ], \"consentType\": \"EXPLICIT\", \"piiCategory\": [ { \"piiCategoryId\": 1, \"validity\": \"days:30\" }, { \"piiCategoryId\": 2, \"validity\": \"days:30\" } ], \"primaryPurpose\": true, \"termination\": \"days:30\", \"thirdPartyDisclosure\": false, \"thirdPartyName\": \"\" } ] } ], \"collectionMethod\": \"Sign-Up\", \"jurisdiction\": \"CA\", \"language\": \"EN\", \"policyURL\": \"https://foo.com/privacy\", \"properties\": [ { \"key\": \"k1\", \"value\": \"v1\" } ]}"
      x-wso2-response: |
        {"consentReceiptId":"38279263-f385-4252-8966-40998faa95ae","collectionMethod":"Sign-Up","language":"EN","piiPrincipalId":"admin","tenantDomain":"carbon.super"}
      summary: |
        Add a new consent purpose

      # post parameters:
      parameters:
        -
          name: piiCategory
          in: body
          description:  This represents the consent to sp mapping element that needs to be stored.
          required: true
          schema:
            $ref: '#/definitions/PIICategoryAddRequest'
      responses:
        201:
          description: Successful response
          schema:
            $ref: '#/definitions/PIIAttribute'
          headers:
            Location:
              type: 'string'
              description: 'Location of the newly created consent.'
        400:
          description: Bad Request
          schema:
            $ref: '#/definitions/Error'
        401:
          description: Unauthorized
          schema:
            $ref: '#/definitions/Error'
        409:
          description: Conflict
          schema:
            $ref: '#/definitions/Error'
        500:
          description: Server Error
          schema:
            $ref: '#/definitions/Error'
      tags:
        - ConsentSPMapping

definitions:
#-----------------------------------------------------
# The Error Response  object
#-----------------------------------------------------
  Error:
    type: object
    properties:
      code:
        type: string
      message:
        type: string
      description:
        type: string
#-----------------------------------------------------

#-----------------------------------------------------
# ConsentSPMapping request object
#-----------------------------------------------------
  ConsentSPMappingRequest:
    type: object
    properties:
      id:
        type: 'integer'
      consumerKey:
        type: 'string'
      purposeId:
        type: 'integer'

#-----------------------------------------------------
# ConsentSPMapping Add response object
#-----------------------------------------------------
  ConsentSPMappingAddResponse:
    type: object
    properties:
      id:
        type: 'integer'
      consumerKey:
        type: 'string'
      purposeId:
        type: 'integer'
      appName:
        type: 'string'
      purposeName:
        type: 'string'

#-----------------------------------------------------
# ConsentSPMapping Add response object
#-----------------------------------------------------
  ConsentSPMappingEditResponse:
    type: object
    properties:
      id:
        type: 'integer'
      consumerKey:
        type: 'string'
      purposeId:
        type: 'integer'
      appName:
        type: 'string'
      purposeName:
        type: 'string'

#-----------------------------------------------------
# ConsentSPMapping response object
#-----------------------------------------------------
  ConsentSPMappingResponse:
    type: object
    properties:
      id:
        type: 'integer'
      consumerKey:
        type: 'string'
      purposeId:
        type: 'integer'
      appName:
        type: 'string'
      purposeName:
        type: 'string'

#-----------------------------------------------------
# List of applications response object
#-----------------------------------------------------
  ApplicationsListResponse:
    type: object
    properties:
      applications:
        type: array
        items:
          $ref: '#/definitions/ApplicationsListItem'

#-----------------------------------------------------
# Application object
#-----------------------------------------------------
  ApplicationsListItem:
    type: object
    properties:
      id:
        type: 'string'
      name:
        type: 'string'
      purposes:
        type: array
        items:
          $ref: '#/definitions/PurposeItem'

#-----------------------------------------------------
# Consent purpose object
#-----------------------------------------------------
  PurposeItem:
    type: object
    properties:
      id:
        type: 'integer'
      name:
        type: 'string'

#-----------------------------------------------------
# ConsentPurpose request object
#-----------------------------------------------------
  ConsentPurposeRequest:
    type: object
    properties:
      Resource:
        type: 'string'
      Purpose:
        $ref: '#/definitions/Purpose'
      AttributeList:
        type: array
        items:
          $ref: '#/definitions/PIIAttribute'

#-----------------------------------------------------
# ConsentPurpose add response object
#-----------------------------------------------------
  ConsentAddPurposeResponse:
    type: object
    properties:
      Resource:
        type: 'string'
      Purpose:
        $ref: '#/definitions/Purpose'

#-----------------------------------------------------
# ConsentPurpose add response object
#-----------------------------------------------------
  ConsentListPurposeResponse:
    type: object
    properties:
      purposes:
        type: array
        items:
          $ref: '#/definitions/ConsentPurposeResponse'

#-----------------------------------------------------
# ConsentPurpose add response object
#-----------------------------------------------------
  ConsentPurposeResponse:
    type: object
    properties:
      Resource:
        type: 'string'
      Purpose:
        $ref: '#/definitions/Purpose'
      AttributeList:
        type: array
        items:
          $ref: '#/definitions/PIIAttribute'

#-----------------------------------------------------
# ConsentPurpose add response object
#-----------------------------------------------------
  PIICategoryResponse:
    type: object
    properties:
      categories:
        type: array
        items:
          $ref: '#/definitions/PIIAttributeWithMapping'

#-----------------------------------------------------
# PIICategory add response object
#-----------------------------------------------------
  PIICategoryAddRequest:
    type: object
    properties:
      type:
        type: 'string'
      piiCategoryId:
        type: 'integer'
      piiAttribute:
        $ref: '#/definitions/PIIAttribute'

#-----------------------------------------------------
# PIICategory get response object
#-----------------------------------------------------
  PIIAttributeWithMapping:
    type: object
    properties:
      type:
        type: 'string'
      piiCategoryId:
        type: 'integer'
      piiAttribute:
        $ref: '#/definitions/PIIAttribute'

#-----------------------------------------------------
# ConsentPurpose request object
#-----------------------------------------------------
  PurposePIIMappingRequest:
    type: object
    properties:
      mappingId:
        type: 'integer'
      appName:
        type: 'string'
      selectedPiiAttributes:
        type: array
        items:
          type: 'integer'
      mandatoryPiiAttributes:
        type: array
        items:
          type: 'integer'

#-----------------------------------------------------
# ConsentAppPurpose request object
#-----------------------------------------------------
  AppPurposeRequest:
    type: object
    properties:
      purposeId:
        type: 'integer'
      appId:
        type: 'string'

#-----------------------------------------------------
# Purpose object
#-----------------------------------------------------
  Purpose:
    type: object
    properties:
      id:
        type: 'integer'
      name:
        type: 'string'
      group:
        type: 'string'
      description:
        type: 'string'
      groupType:
        type: 'string'
      mandatory:
        type: 'boolean'

#-----------------------------------------------------
# PII Attribute object
#-----------------------------------------------------
  PIIAttribute:
    type: object
    properties:
      name:
        type: 'string'
      displayName:
        type: 'string'
      description:
        type: 'string'
      fhirPath:
        type: 'string'

#-----------------------------------------------------
# Parameters
#-----------------------------------------------------
parameters:
  mappingId:
    name: mappingId
    in: path
    description: The unique identifier of a sp purpose mapping
    type: integer
    required: true

  limit:
    name: limit
    in: query
    description: Number of search results
    required: false
    type: integer

  offset:
    name: offset
    in: query
    description: Start index of the search
    required: false
    type: integer

  consumerKey:
    name: consumerKey
    in: query
    description: service provider app id
    required: false
    type: string

  appName:
    name: appName
    in: query
    description: service provider app name
    required: false
    type: string

  purposeId:
    name: purposeId
    in: query
    description: consent purpose id
    required: false
    type: integer

